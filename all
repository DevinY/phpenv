#!/bin/bash
source .functions.sh
CURRENT_PROJECT=$(grep "PROJECT" .env|cut -d= -f2)
for PROJECT in $(grep 'PROJECT' $(find envs -maxdepth 1 -type f -not -path 'envs/.*')|cut -d= -f2)
do
    if [ $1 ];then
        if [ ! -f $1 ];then
                echo "Sub command not found!"
           exit 
        fi
    	ln -sf "envs/${PROJECT}" .env
        ./$1
	#link back to current project
    	ln -sf "envs/${CURRENT_PROJECT}" .env
    else
        if [[ ${PROJECT} = ${CURRENT_PROJECT} ]]; then
            echo "Project: * ${PROJECT} (current)"
            else
            echo "Project: ${PROJECT}"
        fi
        docker-compose -p ${PROJECT} ps
    fi
    echo -e "\n"
done

